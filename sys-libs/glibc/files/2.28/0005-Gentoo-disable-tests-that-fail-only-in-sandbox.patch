From 0605322d7e9e228fcb6e5a168a73853fd7f24555 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20K=2E=20H=C3=BCttel?= <dilfridge@gentoo.org>
Date: Mon, 11 Sep 2017 13:14:46 +0200
Subject: [PATCH 05/94] Gentoo: disable tests that fail only in sandbox

---
 elf/Makefile    | 16 +---------------
 nptl/Makefile   |  6 +++---
 posix/Makefile  |  4 ++--
 resolv/Makefile |  5 -----
 4 files changed, 6 insertions(+), 25 deletions(-)

diff --git a/elf/Makefile b/elf/Makefile
index cd0771307f..0a7201d7cc 100644
--- a/elf/Makefile
+++ b/elf/Makefile
@@ -358,8 +358,7 @@ tests-special += $(objpfx)order-cmp.out $(objpfx)tst-array1-cmp.out \
 		 $(objpfx)tst-array4-cmp.out $(objpfx)tst-array5-cmp.out \
 		 $(objpfx)tst-array5-static-cmp.out $(objpfx)order2-cmp.out \
 		 $(objpfx)tst-initorder-cmp.out \
-		 $(objpfx)tst-initorder2-cmp.out $(objpfx)tst-unused-dep.out \
-		 $(objpfx)tst-unused-dep-cmp.out
+		 $(objpfx)tst-initorder2-cmp.out
 endif
 
 check-abi: $(objpfx)check-abi-ld.out
@@ -1347,19 +1346,6 @@ $(objpfx)tst-relsort1mod2.so: $(libm)
 $(objpfx)tst-relsort1.out: $(objpfx)tst-relsort1mod1.so \
 			   $(objpfx)tst-relsort1mod2.so
 
-$(objpfx)tst-unused-dep.out: $(objpfx)testobj1.so
-	$(test-wrapper-env) \
-	LD_TRACE_LOADED_OBJECTS=1 \
-	LD_DEBUG=unused \
-	LD_PRELOAD= \
-	$(rtld-prefix) \
-	  $< > $@; \
-	$(evaluate-test)
-
-$(objpfx)tst-unused-dep-cmp.out: $(objpfx)tst-unused-dep.out
-	cmp $< /dev/null > $@; \
-	$(evaluate-test)
-
 $(objpfx)tst-audit11.out: $(objpfx)tst-auditmod11.so $(objpfx)tst-audit11mod1.so
 $(objpfx)tst-audit11: $(libdl)
 tst-audit11-ENV = LD_AUDIT=$(objpfx)tst-auditmod11.so
diff --git a/nptl/Makefile b/nptl/Makefile
index be8066524c..6311531097 100644
--- a/nptl/Makefile
+++ b/nptl/Makefile
@@ -260,7 +260,7 @@ tests = tst-attr1 tst-attr2 tst-attr3 tst-default-attr \
 	tst-rwlock9 tst-rwlock10 tst-rwlock11 tst-rwlock12 tst-rwlock13 \
 	tst-rwlock14 tst-rwlock15 tst-rwlock16 tst-rwlock17 tst-rwlock18 \
 	tst-once1 tst-once2 tst-once3 tst-once4 tst-once5 \
-	tst-key1 tst-key2 tst-key3 tst-key4 \
+	tst-key2 tst-key3 \
 	tst-sem1 tst-sem2 tst-sem3 tst-sem4 tst-sem5 tst-sem6 tst-sem7 \
 	tst-sem8 tst-sem9 tst-sem10 tst-sem14 \
 	tst-sem15 tst-sem16 \
@@ -279,7 +279,7 @@ tests = tst-attr1 tst-attr2 tst-attr3 tst-default-attr \
 	tst-atfork1 \
 	tst-cancel1 tst-cancel2 tst-cancel3 tst-cancel4 tst-cancel4_1 \
 	tst-cancel4_2 tst-cancel5 \
-	tst-cancel6 tst-cancel7 tst-cancel8 tst-cancel9 tst-cancel10 \
+	tst-cancel6 tst-cancel8 tst-cancel9 tst-cancel10 \
 	tst-cancel11 tst-cancel12 tst-cancel13 tst-cancel14 tst-cancel15 \
 	tst-cancel16 tst-cancel17 tst-cancel18 tst-cancel19 tst-cancel20 \
 	tst-cancel21 tst-cancel22 tst-cancel23 tst-cancel24 tst-cancel25 \
@@ -376,7 +376,7 @@ CFLAGS-tst-cleanup2.c += -fno-builtin
 CFLAGS-tst-cleanupx2.c += -fno-builtin
 
 tests += tst-cancelx2 tst-cancelx3 tst-cancelx4 tst-cancelx5 \
-	 tst-cancelx6 tst-cancelx7 tst-cancelx8 tst-cancelx9 tst-cancelx10 \
+	 tst-cancelx6 tst-cancelx8 tst-cancelx9 tst-cancelx10 \
 	 tst-cancelx11 tst-cancelx12 tst-cancelx13 tst-cancelx14 tst-cancelx15 \
 	 tst-cancelx16 tst-cancelx17 tst-cancelx18 tst-cancelx20 tst-cancelx21 \
 	 tst-cleanupx0 tst-cleanupx1 tst-cleanupx2 tst-cleanupx3 tst-cleanupx4 \
diff --git a/posix/Makefile b/posix/Makefile
index 00c62841a2..b5542720f5 100644
--- a/posix/Makefile
+++ b/posix/Makefile
@@ -65,7 +65,7 @@ routines :=								      \
 	get_child_max sched_cpucount sched_cpualloc sched_cpufree
 
 aux		:= init-posix environ
-tests		:= test-errno tstgetopt testfnm runtests runptests \
+tests		:= tstgetopt testfnm runtests runptests \
 		   tst-preadwrite tst-preadwrite64 test-vfork regexbug1 \
 		   tst-mmap tst-mmap-offset tst-getaddrinfo tst-truncate \
 		   tst-truncate64 tst-fork tst-fnmatch tst-regexloc tst-dir \
@@ -86,7 +86,7 @@ tests		:= test-errno tstgetopt testfnm runtests runptests \
 		   tst-execve1 tst-execve2 tst-execle1 tst-execle2 \
 		   tst-execvp3 tst-execvp4 \
 		   tst-execvpe1 tst-execvpe2 tst-execvpe3 tst-execvpe4 \
-		   tst-execvpe5 tst-execvpe6 \
+		   tst-execvpe6 \
 		   tst-getaddrinfo3 tst-fnmatch2 tst-cpucount tst-cpuset \
 		   bug-getopt1 bug-getopt2 bug-getopt3 bug-getopt4 \
 		   bug-getopt5 tst-getopt_long1 bug-regex34 bug-regex35 \
diff --git a/resolv/Makefile b/resolv/Makefile
index 55fb992632..8f352dc734 100644
--- a/resolv/Makefile
+++ b/resolv/Makefile
@@ -64,11 +64,6 @@ tests += \
   tst-resolv-ai_idn-nolibidn2 \
   tst-resolv-canonname \
 
-# uses DEPRECATED_RES_USE_INET6 from <resolv-internal.h>.
-tests-internal += \
-  tst-resolv-res_init \
-  tst-resolv-res_init-thread \
-
 # Needs resolv_context.
 tests-internal += \
   tst-resolv-res_ninit \
-- 
2.21.0

